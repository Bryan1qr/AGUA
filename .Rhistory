"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
tab
}
inspect(df1, cod_estacion = "RLocu1")
inspect(df1, cod_estacion = "RLocu2")
wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "LOCUMBA",punto =  "RLocu2", data = df1, cat = "C1A2", subindice = "1")
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "LOCUMBA",punto =  "RLocu2", data = df1, cat = "C1A2", subindice = "1")
calc_wqi(a)
a <- wqi_data(date1 = "2016-01-01", date2 = "2022-12-31",
cuenca = "LOCUMBA",punto =  "RLocu2", data = df1, cat = "C1A2", subindice = "1")
calc_wqi(a)
a <- wqi_data(date1 = "2016-01-01", date2 = "2022-12-31",
cuenca = "CAPLINA",punto =  "RCapl3", data = df1, cat = "C1A2", subindice = "1")
calc_wqi(a)
view(DF1)
View(df1)
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "CAPLINA",punto =  "RCapl3", data = df1, cat = "C1A2", subindice = "1")
calc_wqi(a)
wqi_data <- function(date1, date2, cuenca, punto, data, cat, subindice){
r1 <- data %>%
filter(fecha_larga >= date1 & fecha_larga <= date2 & cuenca == cuenca & tipo == "lotico" & estacion == punto) %>%
select(fecha_larga, PARAMETROS, valor,Scateg, UNIDAD, val_eca1) %>% mutate(DetectionLimit = NA) %>%
filter(PARAMETROS %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Oxígeno Disuelto",
"Coliformes Termotolerantes", "Fósforo Total", "Amoniaco-N",
"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
}
}
inspect(df1, cod_estacion = "RLocu2")
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "CAPLINA",punto =  "RCapl3", data = df1, cat = "C1A2", subindice = "1")
calc_wqi(a)
wqi_data <- function(date1, date2, cuenca, punto, data, cat, subindice){
r1 <- data %>%
filter(fecha_larga >= date1 & fecha_larga <= date2 & cuenca == cuenca & tipo == "lotico" & estacion == punto) %>%
select(fecha_larga, PARAMETROS, valor,Scateg, UNIDAD, val_eca1) %>% mutate(DetectionLimit = NA) %>%
filter(PARAMETROS %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Oxígeno Disuelto",
"Coliformes Termotolerantes", "Fósforo Total", "Amoniaco-N",
"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
}
}
wqi_data <- function(date1, date2, cuenca, punto, data, cat, subindice){
r1 <- data %>%
filter(fecha_larga >= date1 & fecha_larga <= date2 & cuenca == cuenca & tipo == "lotico" & estacion == punto) %>%
select(fecha_larga, PARAMETROS, valor,Scateg, UNIDAD, val_eca1) %>% mutate(DetectionLimit = NA) %>%
filter(PARAMETROS %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Oxígeno Disuelto",
"Coliformes Termotolerantes", "Fósforo Total", "Amoniaco-N",
"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C1A2" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
}
}
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "CAPLINA",punto =  "RCapl3", data = df1, cat = "C1A2", subindice = "2")
calc_wqi(a)
unique(df1$Scateg)
wqi_data <- function(date1, date2, cuenca, punto, data, cat, subindice){
r1 <- data %>%
filter(fecha_larga >= date1 & fecha_larga <= date2 & cuenca == cuenca & tipo == "lotico" & estacion == punto) %>%
select(fecha_larga, PARAMETROS, valor,Scateg, UNIDAD, val_eca1) %>% mutate(DetectionLimit = NA) %>%
filter(PARAMETROS %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Oxígeno Disuelto",
"Coliformes Termotolerantes", "Fósforo Total", "Amoniaco-N",
"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C1A2" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
} else if (cat == "C3D1" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo", "Cobre"))
} else if (cat == "C3D1" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
}
}
inspect(df1, cod_estacion = "RSama5")
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "SAMA",punto =  "RSama5", data = df1, cat = "C3D1", subindice = "2")
calc_wqi(a)
unique(df1$Scateg)
wqi_data <- function(date1, date2, cuenca, punto, data, cat, subindice){
r1 <- data %>%
filter(fecha_larga >= date1 & fecha_larga <= date2 & cuenca == cuenca & tipo == "lotico" & estacion == punto) %>%
select(fecha_larga, PARAMETROS, valor,Scateg, UNIDAD, val_eca1) %>% mutate(DetectionLimit = NA) %>%
filter(PARAMETROS %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Oxígeno Disuelto",
"Coliformes Termotolerantes", "Fósforo Total", "Amoniaco-N",
"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C1A2" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
} else if (cat == "C3D1" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo", "Cobre"))
} else if (cat == "C3D1" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C4E2" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH", "Arsénico", "Plomo", "Cobre", "Mercurio",
"Zinc", "Sólidos Suspendidos Totales"))
} else if (cat == "C4E2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Oxígeno Disuelto",
"Coliformes Termotolerantes",
"Fósforo Total"))
}
}
inspect(df1, cod_estacion = "QKovi1")
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "SAMA",punto =  "QKovi1", data = df1, cat = "C4E2", subindice = "2")
calc_wqi(a)
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "SAMA",punto =  "QKovi1", data = df1, cat = "C4E2", subindice = "1")
calc_wqi(a)
library(tidyverse)
source("script_de_agua.R")
# La ejecución puede tardar un poco:
df1 <- dataset_agua(ruta = "data", tabla_agua = "cuerpos de agua.xlsx")
df1 %>% filter(is.na(valor_mod))
df1 %>% filter(is.na(valor_mod)) %>% View()
openxlsx::write.xlsx(df1, "data_agua_v6.xlsx")
wqi_data <- function(date1, date2, cuenca, punto, data, cat, subindice){
r1 <- data %>%
filter(fecha_larga >= date1 & fecha_larga <= date2 & cuenca == cuenca & tipo == "lotico" & estacion == punto) %>%
select(fecha_larga, PARAMETROS, valor,Scateg, UNIDAD, val_eca1) %>% mutate(DetectionLimit = NA) %>%
filter(PARAMETROS %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Oxígeno Disuelto",
"Coliformes Termotolerantes", "Fósforo Total", "Amoniaco-N",
"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C1A2" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
} else if (cat == "C3D1" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo", "Cobre"))
} else if (cat == "C3D1" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C4E2" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH", "Arsénico", "Plomo", "Cobre", "Mercurio",
"Zinc", "Sólidos Suspendidos Totales"))
} else if (cat == "C4E2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Oxígeno Disuelto",
"Coliformes Termotolerantes",
"Fósforo Total"))
}
}
inspect(df1, cod_estacion = "QKovi1")
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "SAMA",punto =  "QKovi1", data = df1, cat = "C4E2", subindice = "1")
calc_wqi(a)
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "SAMA",punto =  "QKovi1", data = df1, cat = "C4E2", subindice = "2")
calc_wqi(a)
a
View(a)
wqi_data <- function(date1, date2, cuenca, punto, data, cat, subindice){
r1 <- data %>%
filter(fecha_larga >= date1 & fecha_larga <= date2 & cuenca == cuenca & tipo == "lotico" & estacion == punto) %>%
select(fecha_larga, PARAMETROS, valor,Scateg, UNIDAD, val_eca1) %>% mutate(DetectionLimit = NA) %>%
filter(PARAMETROS %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Oxígeno Disuelto",
"Coliformes Termotolerantes", "Fósforo Total", "Amoniaco-N",
"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C3D1" & subindice == "1"){
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C4E2" & subindice == "1"){
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C4E1" & subindice == "1"){
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C1A2" & subindice == "2"){
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
} else if (cat == "C3D1" & subindice == "2"){
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
} else if (cat == "C4E1" & subindice == "2"){
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
} else if (cat == "C4E2" & subindice == "2"){
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
} else {
print("establece que categoría de ECA corresponde!!! c1, c3 o c4")
}
wqindex::calc_wqi(tab, messages = FALSE)
}
inspect <- function(tabla, cod_estacion){
tabla %>% filter(estacion == cod_estacion) %>% select(Scateg, cuenca, estacion) %>% distinct()
}
inspect(tabla = df1, cod_estacion = "QCari1")
wqi_data(date1 = "2016-01-01",
date2 = "2019-12-31",
cuenca = "USHUSUMA", punto = "QCari1",
data = df1,
cat = "C4E2",
subindice = "2")
wqi_data <- function(date1, date2, cuenca, punto, data, cat, subindice){
r1 <- data %>%
filter(fecha_larga >= date1 & fecha_larga <= date2 & cuenca == cuenca & tipo == "lotico" & estacion == punto) %>%
select(fecha_larga, PARAMETROS, valor,Scateg, UNIDAD, val_eca1) %>% mutate(DetectionLimit = NA) %>%
filter(PARAMETROS %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Oxígeno Disuelto",
"Coliformes Termotolerantes", "Fósforo Total", "Amoniaco-N",
"Nitratos (NO3-)",
"pH", "Arsénico", "Aluminio", "Manganeso", "Hierro", "Cadmio", "Plomo",
"Boro", "Cobre", "Mercurio", "Zinc", "Sólidos Suspendidos Totales")) %>%
filter(!is.na(val_eca1))
tab <- r1 %>% separate(val_eca1, into = c("LowerLimit", "UpperLimit"), sep = " – ") %>%
mutate(
# Si el parámetro es Oxígeno Disuelto o pH, mantenemos el UpperLimit original
UpperLimit = if_else(
PARAMETROS %in% c("pH", "Oxígeno Disuelto"),
UpperLimit, # Mantener el valor de UpperLimit tal cual está
if_else(!PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit, NA)),
LowerLimit = if_else(PARAMETROS %in% c("pH", "Oxígeno Disuelto"),LowerLimit,NA)) %>%
select(fecha_larga, PARAMETROS, valor, DetectionLimit, LowerLimit, UpperLimit, UNIDAD) %>%
rename("Date" = "fecha_larga", "Variable" = "PARAMETROS", "Value" = "valor", "units" = "UNIDAD") %>%
mutate(Value = str_remove_all(Value, "^(>+|<+|<=|>=)") %>%
str_remove_all("[=\\-\\s]") %>% str_replace(",", ".") %>% as.numeric(),
UpperLimit = str_remove_all(UpperLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
LowerLimit = str_remove_all(LowerLimit, "^(>+|<+|<=|>=|=+)")%>%
str_remove_all("[=\\-\\s]") %>% str_replace( ",", ".") %>% as.numeric(),
DetectionLimit = as.numeric(DetectionLimit),
Date = as.Date(Date))
if (cat == "C1A2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Amoniaco-N","Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)", "Fósforo Total",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C1A2" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo"))
} else if (cat == "C3D1" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH","Aluminio", "Arsénico", "Boro", "Cadmio",
"Hierro", "Manganeso", "Plomo", "Cobre"))
} else if (cat == "C3D1" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Demanda Química de Oxígeno (DQO)",
"Oxígeno Disuelto",
"Coliformes Termotolerantes"))
} else if (cat == "C4E2" & subindice == "2") {
tab <- tab %>% filter(Variable %in% c("pH", "Arsénico", "Plomo", "Cobre", "Mercurio",
"Zinc", "Sólidos Suspendidos Totales"))
} else if (cat == "C4E2" & subindice == "1") {
tab <- tab %>% filter(Variable %in% c("Demanda Bioquímica de Oxígeno (DBO5)",
"Oxígeno Disuelto",
"Coliformes Termotolerantes",
"Fósforo Total"))
}
}
inspect(df1, cod_estacion = "QKovi1")
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "SAMA",punto =  "QKovi1", data = df1, cat = "C4E2", subindice = "2")
View(a)
a <- wqi_data(date1 = "2016-01-01", date2 = "2019-12-31",
cuenca = "SAMA",punto =  "QKovi1", data = df1, cat = "C4E2", subindice = "1")
View(a)
View(df1)
df1$val_eca1
gsub("[^0-9]", "", df1$val_eca1)
df1$val_eca1
gsub("[^0-9,]", "", df1$val_eca1)
gsub("[^0-9,]", "", df1$val_eca1) %>% slice(1:20)
gsub("[^0-9,]", "", df1$val_eca1) %>% slice(10)
gsub("[^0-9,]", "", df1$val_eca1)[10]
gsub("[^0-9,]", "", df1$val_eca1)[1:10]
df1$val_eca1[1:10]
gsub("[^0-9,]", "", df1$val_eca1) %>% gsub(",", ".")
, df1$val_eca1 %>% gsub("[^0-9,]", "") %>% gsub(",", ".")
df1$val_eca1 %>% gsub("[^0-9,]", "") %>% gsub(",", ".")
df1$val_eca1 %>% gsub("[^0-9,]", "")
df1$val_eca1 %>% gsub("[^0-9,]")
gsub("[^0-9,]", "", df1$val_eca1) %>% gsub(",", ".")
gsub("[^0-9,]", "", df1$val_eca1)[1:10]
gsub("[^0-9,]", "", df1$val_eca1)[1:10] %>% gsub(",", ",")
gsub("[^0-9,]", "", df1$val_eca1)[1:10] ->a
gsub(",", ".", a)
gsub(",", ".", a) %>% as.numeric()
View(df1)
gc()
